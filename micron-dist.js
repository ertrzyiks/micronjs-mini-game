!function(){function t(t){return"[object Function]"==Object.prototype.toString.call(t)}function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function i(t){return s(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t}function s(t,i,s){var n=Array.prototype.forEach;if(null!=t)if(n&&t.forEach===n)t.forEach(i,s);else if(t.length===+t.length){for(var a=0,h=t.length;h>a;a++)if(i.call(s,t[a],a,t)===breaker)return}else for(var r in t)if(e(t,r)&&i.call(s,t[r],r,t)===breaker)return}var n=this,a=function(){};"undefined"!=typeof exports?module.exports=a:n.Base=a,a.prototype.constructor=function(){},a.prototype._getParentFn=function(t){var e=function(){};if(t&&t.__name__){var i=t.__owner__,s=t.__name__;if(!i.prototype[s])throw new Error("Parent function `"+s+"` not found.");e=i.prototype[s]}return e},a._getParentFn=function(t){var e=function(){};if(t&&t.__name__){var i=t.__owner__,s=t.__name__;if(!i[s])throw new Error("Parent function `"+s+"` not found.");e=i[s]}return e},a.callParent=a.prototype.callParent=function(){var t=arguments.callee.caller,e=this._getParentFn(t);return e.apply(this,arguments)},a.applyParent=a.prototype.applyParent=function(t){var e=arguments.callee.caller,i=this._getParentFn(e);return i.apply(this,t)},a.__getInterfaces=function(){return[]},a.implement=function(t){return this.extend(null,{__getInterfaces:function(){var e=this.callParent();return e.push(t.prototype),e}})},a.prototype.isImplementing=function(e){if(e&&!t(e))throw new Error("Given interface "+e+" is not function");e=e.prototype;for(var i=this.constructor,s=i.__getInterfaces(),n=s.length,a=0;n>a;a++)if(s[a]===e)return!0;return!1},a.use=function(e){if(e&&!t(e))throw new Error("Given prototype mixin "+e+"is not function");return this.extend(e,e)},a.extend=function(n,a){var h=!1;n&&(t(n)&&(n=n.prototype,h=!0),s(this.__getInterfaces(),function(t){for(var e in t)if(e in n);else if(!(e in this.prototype))throw new Error("Interface member `"+e+"` is not implemented!")},this)),n=n||{};var r,o,c=this;for(o in n)t(n[o])&&(n[o].__name__=o,n[o].__owner__=c);for(o in a)t(a[o])&&(a[o].__name__=o,a[o].__owner__=c);n&&e(n,"constructor")&&!h?r=n.constructor:(n.constructor=function(){c.apply(this,arguments)},n.constructor.__name__="constructor",n.constructor.__owner__=c,r=n.constructor),i(r,c,a);var u=function(){this.constructor=r};return u.prototype=c.prototype,r.prototype=new u,n&&i(r.prototype,n),r.__owner__=c,r}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var tweenEmptyFunc=function(){},TweenObject=Base.extend({object:null,property:"",initial:0,destination:0,time:0,easing:"easeLinearIn",callback:tweenEmptyFunc,currentTime:0,constructor:function(t,e,i,s,n,a){this.object=t,this.initial=this.object[e],this.property=e,this.destination=i,this.time=s,"undefined"!=typeof n&&null!==n&&(this.easing=n),"undefined"!=typeof a&&null!==a&&(this.callback=a)}}),UtilsDef=Base.extend({_tweenFuncs:null,_tweens:null,E_LINEAR_IN:"easeLinearIn",E_LINEAR_OUT:"easeLinearOut",E_LINEAR_INOUT:"easeLinearInOut",E_SINE_IN:"easeSineIn",E_SINE_OUT:"easeSineOut",E_SINE_INOUT:"easeSineInOut",E_QUAD_IN:"easeQuadIn",E_QUAD_OUT:"easeQuadOut",E_QUAD_INOUT:"easeQuadInOut",E_EXPO_IN:"easeExpoIn",E_EXPO_OUT:"easeExpoOut",E_EXPO_INOUT:"easeExpoInOut",E_ELASTIC_IN:"easeElasticIn",E_ELASTIC_OUT:"easeElasticOut",E_ELASTIC_INOUT:"easeElasticInOut",E_CUBIC_IN:"easeCubicIn",E_CUBIC_OUT:"easeCubicOut",E_CUBIC_INOUT:"easeCubicInOut",E_CIRCULAR_IN:"easeCircularIn",E_CIRCULAR_OUT:"easeCircularOut",E_CIRCULAR_INOUT:"easeCircularInOut",E_BOUNCE_IN:"easeBounceIn",E_BOUNCE_OUT:"easeBounceOut",E_BOUNCE_INOUT:"easeBounceInOut",E_BACK_IN:"easeBackIn",E_BACK_OUT:"easeBackOut",E_BACK_INOUT:"easeBackInOut",constructor:function(){this._tweenFuncs={},this._tweenFuncs[this.E_LINEAR_IN]=this.easeLinear.bind(this),this._tweenFuncs[this.E_LINEAR_OUT]=this.easeLinear.bind(this),this._tweenFuncs[this.E_LINEAR_INOUT]=this.easeLinear.bind(this),this._tweenFuncs[this.E_SINE_IN]=this.easeSineIn.bind(this),this._tweenFuncs[this.E_SINE_OUT]=this.easeSineOut.bind(this),this._tweenFuncs[this.E_SINE_INOUT]=this.easeSineInOut.bind(this),this._tweenFuncs[this.E_QUAD_IN]=this.easeQuadIn.bind(this),this._tweenFuncs[this.E_QUAD_OUT]=this.easeQuadOut.bind(this),this._tweenFuncs[this.E_QUAD_INOUT]=this.easeQuadInOut.bind(this),this._tweenFuncs[this.E_EXPO_IN]=this.easeExpoIn.bind(this),this._tweenFuncs[this.E_EXPO_OUT]=this.easeExpoOut.bind(this),this._tweenFuncs[this.E_EXPO_INOUT]=this.easeExpoInOut.bind(this),this._tweenFuncs[this.E_ELASTIC_IN]=this.easeElasticIn.bind(this),this._tweenFuncs[this.E_ELASTIC_OUT]=this.easeElasticOut.bind(this),this._tweenFuncs[this.E_ELASTIC_INOUT]=this.easeElasticInOut.bind(this),this._tweenFuncs[this.E_CUBIC_IN]=this.easeCubicIn.bind(this),this._tweenFuncs[this.E_CUBIC_OUT]=this.easeCubicOut.bind(this),this._tweenFuncs[this.E_CUBIC_INOUT]=this.easeCubicInOut.bind(this),this._tweenFuncs[this.E_CIRCULAR_IN]=this.easeCircularIn.bind(this),this._tweenFuncs[this.E_CIRCULAR_OUT]=this.easeCircularOut.bind(this),this._tweenFuncs[this.E_CIRCULAR_INOUT]=this.easeCircularInOut.bind(this),this._tweenFuncs[this.E_BOUNCE_IN]=this.easeBounceIn.bind(this),this._tweenFuncs[this.E_BOUNCE_OUT]=this.easeBounceOut.bind(this),this._tweenFuncs[this.E_BOUNCE_INOUT]=this.easeBounceInOut.bind(this),this._tweenFuncs[this.E_BACK_IN]=this.easeBackIn.bind(this),this._tweenFuncs[this.E_BACK_OUT]=this.easeBackOut.bind(this),this._tweenFuncs[this.E_BACK_INOUT]=this.easeBackInOut.bind(this),this._tweens=[]},update:function(t){for(var e,i=0;i<this._tweens.length;i++){var s=0;(this.isEmpty(this._tweens[i].object)||this.isEmpty(this._tweens[i].object[this._tweens[i].property]))&&(this._tweens.indexOf(this._tweens[i]),this._tweens.splice(s,1)),this._tweens[i].currentTime+=t,e=this._execTween(this._tweens[i].currentTime,this._tweens[i].initial,this._tweens[i].destination-this._tweens[i].initial,this._tweens[i].time,this._tweens[i].easing),this._tweens[i].object[this._tweens[i].property]=e,this._tweens[i].currentTime>=this._tweens[i].time&&(this._tweens[i].object[this._tweens[i].property]=this._tweens[i].destination,this._tweens[i].callback(),this._tweens.indexOf(this._tweens[i]),this._tweens.splice(s,1))}},reset:function(){for(var t=0;t<this._tweens.length;t++)this._tweens[t].object[this._tweens[t].property]=this._tweens[t].destination,this._tweens[t].callback();this._tweens=[]},emptyFunc:function(){},isEmpty:function(t){return"undefined"==typeof t||null===t},copyAttributes:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},checkExtension:function(t,e){return this.isEmpty(t)?!1:-1!==t.indexOf(e)},indexToDecimal:function(t){return Math.floor(Math.min(255*t,255))},rgbaToString:function(t,e,i,s){var n="rgba("+this.indexToDecimal(t)+","+this.indexToDecimal(e)+","+this.indexToDecimal(i)+","+this.clamp(0,s,1)+")";return n},invoke:function(t,e){setTimeout(t,1e3*e)},invokeRepeating:function(t,e){setInterval(t,1e3*e)},distance:function(t,e,i,s){return Math.sqrt((t-=i)*t+(e-=s)*e)},angle:function(t,e,i,s){return Math.atan2(i-t,s-e)},randRange:function(t,e){return Math.random()*e+t},intRandRange:function(t,e){return Math.floor(this.randRange(t,e))},randSpread:function(t){return this.randRange(0,t)*(.5-Math.random())},randSign:function(){return Math.random()<.5?-1:1},randFlipCoin:function(){return Math.random()<.5?!1:!0},clamp:function(t,e,i){return Math.min(Math.max(e,t),i)},lerp:function(t,e,i){return t+(e-t)*i},perp:function(t,e,i){return t+i*i*(e-t)},berp:function(t,e,i){return t+i/2*(e-t)},smoothStep:function(t){return t*t*(3-2*t)*2},easeLinear:function(t,e,i,s){return i*t/s+e},easeSineIn:function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},easeSineOut:function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},easeSineInOut:function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},easeQuadIn:function(t,e,i,s){return i*(t/=s)*t+e},easeQuadOut:function(t,e,i,s){return-i*(t/=s)*(t-2)+e},easeQuadInOut:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*((t-2)*--t-1)+e},easeExpoIn:function(t,e,i,s){return 0===t?e:i*Math.pow(2,10*(t/s-1))+e},easeExpoOut:function(t,e,i,s){return t===s?e+i:i*(-Math.pow(2,-10*t/s)+1)+e},easeExpoInOut:function(t,e,i,s){return 0===t?e:t===s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e},easeElasticIn:function(t,e,i,s){if(0===t)return e;if(1===(t/=s))return e+i;var n=.3*s,a=i,h=n/4,r=a*Math.pow(2,10*(t-=1));return-(r*Math.sin(2*(t*s-h)*Math.PI/n))+e},easeElasticOut:function(t,e,i,s){if(0===t)return e;if(1===(t/=s))return e+i;var n=.3*s,a=i,h=n/4;return a*Math.pow(2,-10*t)*Math.sin(2*(t*s-h)*Math.PI/n)+i+e},easeElasticInOut:function(t,e,i,s){if(0===t)return e;if(2===(t/=s/2))return e+i;var n,a=.45*s,h=i,r=a/4;return 1>t?(n=h*Math.pow(2,10*(t-=1)),-.5*n*Math.sin(2*(t*s-r)*Math.PI/a)+e):(n=h*Math.pow(2,-10*(t-=1)),n*Math.sin(2*(t*s-r)*Math.PI/a)*.5+i+e)},easeCubicIn:function(t,e,i,s){return i*(t/=s)*t*t+e},easeCubicOut:function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},easeCubicInOut:function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeCircularIn:function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},easeCircularOut:function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},easeCircularInOut:function(t,e,i,s){return(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-t*(t-=2))+1)+e},easeBounceOut:function(t,e,i,s){var n;return(t/=s)<.3636?7.5625*i*t*t+e:.7272>t?(n=t-=.5454,i*(7.5625*n*t+.75)+e):.909>t?(n=t-=.8181,i*(7.5625*n*t+.9375)+e):(n=t-=.9545,i*(7.5625*n*t+.984375)+e)},easeBounceIn:function(t,e,i,s){return i-UtilsDef.prototype.bounceOut(s-t,0,i,s)+e},easeBounceInOut:function(t,e,i,s){return s/2>t?.5*UtilsDef.prototype.bounceIn(2*t,0,i,s)+e:.5*UtilsDef.prototype.bounceOut(2*t-s,0,i,s)+.5*i+e},easeBackIn:function(t,e,i,s){var n=1.70158,a=t/=s;return i*a*t*((n+1)*t-n)+e},easeBackOut:function(t,e,i,s){var n=1.70158;return i*((t=t/s-1)*t*((n+1)*t+n)+1)+e},easeBackInOut:function(t,e,i,s){var n=1.70158;if((t/=s/2)<1)return i/2*t*t*(((n*=1.525)+1)*t-n)+e;var a=t-=2;return i/2*(a*t*(((n*=1.525)+1)*t+n)+2)+e},_execTween:function(t,e,i,s,n){var a=this._tweenFuncs[n](t,e,i,s);return a},tween:function(t,e,i,s,n,a){this._tweens.push(new TweenObject(t,e,i,s,n,a))}}),Utils=new UtilsDef,Entity=Base.extend({name:"",entities:null,inUse:!0,constructor:function(t){this.name=t,this.entities=[]},spawn:function(){this.inUse=!0},add:function(t){this.entities.push(t)},remove:function(t){var e=this.entities.indexOf(t);e>-1&&this.entities.splice(e,1)},removeAll:function(){this.entities=[]},clone:function(){var t=new Entity;return t=Utils.copyAttributes(t,this)},update:function(t){for(var e=0;e<this.entities.length;e++)this.entities[e].update(t)},draw:function(){for(var t=0;t<this.entities.length;t++)this.entities[t].draw()},destroy:function(){for(var t=0;t<this.entities.length;t++)this.entities[t].destroy();delete this.entities}}),Pool=Entity.extend({lastSpawned:0,constructor:function(){this.callParent("Pool")},addToPool:function(t,e){if(!(t instanceof Entity))return void console.log("[Core::Pool] Unable to add object "+t+". You must extend from Entity");t.inUse=!1;for(var i=0;e>i;i++){var s=t.clone();this.entities.push(s)}},spawn:function(t){for(var e=[],i=this.lastSpawned;i<this.entities.length&&(this.entities[i].inUse||(this.entities[i].spawn(),this.lastSpawned++),t--,e.push(this.entities[i]),!(0>=t));i++);return this.lastSpawned=this.lastSpawned%this.entities.length,e},update:function(t){var e,i;for(e=this.entities.length-1;e>=0;e--)i=this.entities[e],i.inUse&&i.update(t)},draw:function(){for(var t=0;t<this.entities.length;t++)this.entities[t].inUse&&this.entities[t].draw()}}),State=Entity.extend({constructor:function(t){this.callParent(t)},init:function(){},onPause:function(){}});Core=Base.extend({currentState:null,width:0,height:0,storage:!1,fps:0,fpsCounter:0,elapsed:0,totalTime:0,delta:.016,timeScale:1,date:null,dateNow:null,dateThen:null,loaded:!1,assets:null,assetsMap:null,assetsLoaded:0,pause:!1,constructor:function(){},init:function(t,e){this.width=t,this.height=e,window.addEventListener("resize",this._calculateResize.bind(this)),window.addEventListener("blur",this._onBlur.bind(this)),Graphics.init(this.width,this.height),this._calculateResize(),this.delta=0,this.date=new Date,this.dateThen=Date.now(),this.dateNow=Date.now(),this.storage=this.hasStorageSupport(),this.assets=[],this.assetsMap={}},_calculateResize:function(){var t=this.width,e=this.height,i=window.innerWidth,s=window.innerHeight,n=Math.min(i/t,s/e),a=Math.floor(t*n),h=Math.floor(e*n),r=(i-a)/2,o=(s-h)/2;Graphics.rescale(a,h),Graphics.reposition(r,o)},_onBlur:function(){this.pause=!0,Input.resetAll(),null!==this.currentState&&this.currentState.onPause(!0)},update:function(t){this.elapsed+=t,this.fpsCounter++,this.elapsed>=1&&(this.elapsed=0,this.fps=this.fpsCounter,this.fpsCounter=0),this.pause?Input.isMousePressed()&&(this.pause=!1,null!==this.currentState&&this.currentState.onPause(!1)):(this.totalTime+=t,null!==this.currentState&&this.currentState.update(t*this.timeScale),Utils.update(t*this.timeScale),Graphics.update(t*this.timeScale))},draw:function(){null!==this.currentState&&(Graphics.preDraw(),this.currentState.draw(),Graphics.postDraw()),this.pause&&(Graphics.drawFullScreenRect(0,0,0,.72),Graphics.enableBlur(5,1,1,1,1),Graphics.drawRegularPolygon(Graphics.width/2,Graphics.height/2,3,Utils.scalePercentWidth(25),1,1,1,1,"fill"),Graphics.disableBlur())},run:function(){this.dateNow=this.date.getTime(),this.delta=this.dateNow-this.dateThen,this.delta=this.delta||.016,this.dateThen=this.dateNow,this.update(this.delta),this.draw(),window.requestAnimFrame(this.run.bind(this))},setState:function(t){null!==this.currentState&&this.currentState.destroy(),this.currentState=null,this.currentState=t,this._calculateResize()},getFPS:function(){return this.fps},addAsset:function(t){if(t instanceof Array)for(var e=0;e<t.length;e+=2)this.assetsMap[t[e]]=t[e+1],this.assets.push(t[e+1]);else"string"==typeof t?(this.assets.push(t),this.assetsMap[""]=t):console.log("[Core::addAsset] You should not try to add ",t," as an asset. Try using a string or an array instead.")},loadAndRun:function(){var t,e=!0;for(var i in this.assetsMap)t=this.assetsMap[i],this.assetsMap.hasOwnProperty(i)&&(Utils.checkExtension(t,".jpg")||Utils.checkExtension(t,".png")||Utils.checkExtension(t,".svg"))&&(e=!1,Graphics.loadImage(i,t));e&&this.onImageLoaded()},hasStorageSupport:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},saveToStorage:function(t,e){this.storage&&(localStorage[t]=e)},readFromStorage:function(t){return this.storage?localStorage[t]:null},onImageLoaded:function(){this.assetsLoaded++,this.assetsLoaded>=this.assets.length?null!==this.currentState&&(this.currentState.init(),this.run()):(Graphics.drawFullScreenRect(0,0,0,1),Graphics.enableBlur(25,1,1,1,1),Graphics.drawRegularPolygon(Graphics.width/2,Graphics.height/2,Math.round(this.assetsLoaded/this.assets.length*10)+3,Utils.scalePercentWidth(15),1,1,1,1,"fill"),Graphics.disableBlur(),console.log("[Core::onImageLoaded] Loaded: "+this.assetsLoaded+" / "+(this.assets.length-1)))}});var Core=new Core;Utils.scalePercentWidth=function(t){return Math.round(Core.width*t/100)},Utils.scalePercentHeight=function(t){return Math.round(Core.height*t/100)},Input=Base.extend({keysDown:{},isClick:!1,clickPosition:{x:0,y:0},mousePosition:{x:0,y:0},inputObjectsRegistered:[],supportsMultitouch:!1,scale:{x:1,y:1},offset:{x:0,y:0},KEY_BACK:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CLOCK:20,KEY_ESC:27,KEY_SPACE:32,KEY_PGUP:33,KEY_PGDOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_INSERT:45,KEY_DEL:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_NUM0:96,KEY_NUM1:97,KEY_NUM2:98,KEY_NUM3:99,KEY_NUM4:100,KEY_NUM5:101,KEY_NUM6:102,KEY_NUM7:103,KEY_NUM8:104,KEY_NUM9:105,KEY_MUL:106,KEY_ADD:107,KEY_SUB:109,KEY_POINT:110,KEY_DIV:111,constructor:function(){this.inputObjectsRegistered=[],this.supportsMultitouch=this.checkMulitouchSupport(),this.supportsMultitouch?(addEventListener("touchstart",function(t){var e=t.changedTouches,i=e[0];Input.generateClick(i.clientX,i.clientY)},!0),addEventListener("touchend",function(){Input.releaseClick()},!0)):(addEventListener("mousedown",function(t){Input.generateClick(t.clientX,t.clientY)},!0),addEventListener("mouseup",function(){Input.releaseClick()},!0),addEventListener("mousemove",function(t){Input.mouseMoved(t.clientX,t.clientY)},!0))},resetAll:function(){this.keysDown={},this.isClick=!1,this.clickPosition={x:0,y:0},this.mousePosition={x:0,y:0}},checkMulitouchSupport:function(){return"ontouchstart"in document.documentElement},addInputReceiver:function(t){this.inputObjectsRegistered.push(t)},isKeyPressed:function(t){return t in this.keysDown},isMousePressed:function(){return this.isClick===!0},isMouseReleased:function(){return this.isClick===!1},generateClick:function(t,e){this.isClick=!0,this.clickPosition.x=this.mousePosition.x=t/this.scale.x-this.offset.x/this.scale.x,this.clickPosition.y=this.mousePosition.y=e/this.scale.y-this.offset.y/this.scale.y;for(var i=0;i<this.inputObjectsRegistered.length;i++)this.inputObjectsRegistered[i].onClickInput(this.clickPosition.x,this.clickPosition.y)},releaseClick:function(){this.isClick=!1,this.clickPosition.x=-1,this.clickPosition.y=-1},mouseMoved:function(t,e){this.mousePosition.x=t/this.scale.x-this.offset.x/this.scale.x,this.mousePosition.y=e/this.scale.y-this.offset.y/this.scale.y},getMousePosition:function(){return this.mousePosition},getMousePositionInWorld:function(){var t={x:this.mousePosition.x+Camera.x,y:this.mousePosition.y+Camera.y};return t}});var Input=new Input;addEventListener("keydown",function(t){Input.keysDown[t.keyCode]=!0},!1),addEventListener("keyup",function(t){delete Input.keysDown[t.keyCode]},!1),Camera=Entity.extend({x:0,y:0,shaking:!1,shakeStrength:1,shakeTime:0,shakeOffset:null,onShakeEndCallback:Utils.emptyFunc,fading:!1,overlayColor:null,drawOverlay:!1,onFadeEndCallback:Utils.emptyFunc,constructor:function(){this.callParent("Camera"),this.overlayColor={r:0,g:0,b:0,a:0},this.shakeOffset={x:0,y:0}},shake:function(t,e,i){this.shaking=!0,this.shakeTime=t,this.shakeStrength=e,this.onShakeEndCallback=Utils.isEmpty(i)?Utils.emptyFunc:i},stopShake:function(){this.shaking=!1,this.shakeTime=0,this.shakeStrentgh=0,this.shakeOffset.x=0,this.shakeOffset.y=0},fade:function(t,e,i,s,n){this.fading=!0,this.onFadeEndCallback=Utils.isEmpty(n)?Utils.emptyFunc:n,this.overlayColor.r=t.r,this.overlayColor.g=t.g,this.overlayColor.b=t.b,this.overlayColor.a=t.a,Utils.tween(this.overlayColor,"r",e.r,i,s,n),Utils.tween(this.overlayColor,"g",e.g,i,s),Utils.tween(this.overlayColor,"b",e.b,i,s),Utils.tween(this.overlayColor,"a",e.a,i,s)},update:function(t){this.callParent(t),this.shaking===!0&&(this.shakeTime-=t,this.shakeOffset.x=Utils.randRange(-1*this.shakeStrength,this.shakeStrength),this.shakeOffset.y=Utils.randRange(-1*this.shakeStrength,this.shakeStrength),this.shakeTime<=0&&(this.shaking=!1,this.shakeStartTime=0,this.shakeTime=0,this.onShakeEndCallback(),this.shakeOffset.x=0,this.shakeOffset.y=0))},draw:function(){this.callParent()},getX:function(){return Math.round(this.x+this.shakeOffset.x)},getY:function(){return Math.round(this.y+this.shakeOffset.y)},setOverlayColor:function(t,e,i,s){this.overlayColor.r=t,this.overlayColor.g=e,this.overlayColor.b=i,this.overlayColor.a=s,this.drawOverlay=!0},clearOverlayColor:function(){this.overlayColor.r=0,this.overlayColor.g=0,this.overlayColor.b=0,this.overlayColor.a=0,this.drawOverlay=!1,this.fading=!1}});var Camera=new Camera;Graphics=Base.extend({canvas:null,context:null,initialized:!1,images:null,imagesMap:null,scale:{x:1,y:1},screenRect:null,autoClearScreen:!0,constructor:function(){this.images=[],this.imagesMap={}},init:function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e,this.canvas.style.position="absolute",document.body.appendChild(this.canvas),this.initialized=!0,this.screenRect=this.canvas.getBoundingClientRect()},rescale:function(t,e){this.scale.x=t/this.width,this.scale.y=e/this.height,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.screenRect=this.canvas.getBoundingClientRect(),Input.scale.x=this.scale.x,Input.scale.y=this.scale.y,Input.offset.x=this.screenRect.left,Input.offset.y=this.screenRect.top},reposition:function(t,e){this.canvas.style.left=t+"px",this.canvas.style.top=e+"px"},pixelify:function(t){this.context.imageSmoothingEnabled=!t},getCanvasOffset:function(){return this.screenRect},getWidth:function(){return this.canvas.width},getHeight:function(){return this.canvas.height},onImageLoaded:function(){Core.onImageLoaded()},loadImage:function(t,e){Utils.isEmpty(this.images[e])?(this.images[e]=new Image,this.images[e].src=e,this.images[e].addEventListener("load",this.onImageLoaded.bind(this)),this.imagesMap[t]=e):this.onImageLoaded()},getImage:function(t){return Utils.isEmpty(this.images[t])?Utils.isEmpty(this.imagesMap[t])?(console.log("[Graphics] The image "+t+" is not loaded. Check if it was added on the asset list (addAsset)."),null):this.images[this.imagesMap[t]]:this.images[t]},update:function(t){Camera.update(t)},preDraw:function(){this.autoClearScreen&&this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.context.save(),this.context.translate(-Camera.getX(),-Camera.getY()),this.context.scale(this.scaleRatio,this.scaleRatio)},postDraw:function(){this.context.restore(),Camera.draw(),(Camera.fading||Camera.drawOverlay)&&this.drawFullScreenRect(Camera.overlayColor.r,Camera.overlayColor.g,Camera.overlayColor.b,Camera.overlayColor.a)},_startDraw:function(t,e,i,s,n){"fill"===t?this.context.fillStyle=Utils.rgbaToString(e,i,s,n):"stroke"===t&&(this.context.strokeStyle=Utils.rgbaToString(e,i,s,n))},_endDraw:function(t){"fill"===t?this.context.fill():"stroke"===t&&this.context.stroke()},enableBlur:function(t,e,i,s,n){Graphics.context.shadowBlur=t,Graphics.context.shadowColor=Utils.rgbaToString(e,i,s,n)},disableBlur:function(){Graphics.context.shadowBlur=0,Graphics.context.shadowColor=Utils.rgbaToString(0,0,0,0)},drawText:function(t,e,i,s,n,a,h,r,o){this._startDraw("fill",s,n,a,h),this.context.font=r+"px "+o,this.context.textAlign="left",this.context.textBaseline="top",this.context.fillText(t,e,i)},drawRect:function(t,e,i,s,n,a,h,r,o){Utils.isEmpty(o)&&(o="fill"),this._startDraw(o,n,a,h,r),"fill"===o?this.context.fillRect(t,e,i,s):"stroke"===o&&this.context.strokeRect(t,e,i,s)},drawFullScreenRect:function(t,e,i,s){this.drawRect(0,0,this.width,this.height,t,e,i,s)},drawLine:function(t,e,i,s,n,a,h,r,o,c){this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),Utils.isEmpty(o)||(this.context.lineWidth=o),this.context.strokeStyle=Utils.rgbaToString(n,a,h,r),Utils.isEmpty(c)||(this.context.lineCap=c),this.context.stroke()},drawArc:function(t,e,i,s,n,a,h,r,o,c,u){Utils.isEmpty(u)&&(u="fill"),this.context.beginPath(),this._startDraw(u,a,h,r,o),Utils.isEmpty(c)||(this.context.lineWidth=c),this.context.arc(t,e,i,s,n,!1),this._endDraw(u)},drawCircle:function(t,e,i,s,n,a,h,r){Utils.isEmpty(r)&&(r="fill"),this.context.beginPath(),this._startDraw(r,s,n,a,h),this.context.arc(t,e,i,0,6.28,!1),this._endDraw(r)},drawSprite:function(t,e,i,s,n,a,h,r,o){Utils.isEmpty(t)||(this.context.save(),this.context.globalAlpha=Utils.clamp(0,o,1),this.context.translate(e+s/2,i+n/2),this.context.rotate(a),this.context.scale(h,r),this.context.drawImage(t,-s/2,-n/2),this.context.restore())},drawSpriteCropped:function(t,e,i,s,n,a,h,r,o,c,u,l,d){Utils.isEmpty(t)||(this.context.save(),this.context.globalAlpha=Utils.clamp(0,o,1),this.context.translate(e+s/2,i+n/2),this.context.rotate(a),this.context.scale(h,r),this.context.drawImage(t,c,u,l,d,-s/2,-n/2,s,n),this.context.restore())},drawPolygon:function(t,e,i,s,n,a,h,r){Utils.isEmpty(r)&&(r="fill"),this.context.beginPath(),this._startDraw(r,s,n,a,h),this.context.moveTo(e+t[0],i+t[1]);for(var o=2;o<t.length-1;o+=2)this.context.lineTo(e+t[o],i+t[o+1]);this.context.closePath(),this._endDraw(r)},drawRegularPolygon:function(t,e,i,s,n,a,h,r,o){Utils.isEmpty(o)&&(o="fill"),this.context.beginPath(),this._startDraw(o,n,a,h,r),this.context.moveTo(t+s*Math.cos(0),e+s*Math.sin(0));for(var c=1;i>=c;c+=1)this.context.lineTo(t+s*Math.cos(2*c*Math.PI/i),e+s*Math.sin(2*c*Math.PI/i));this.context.closePath(),this._endDraw(o)}});var Graphics=new Graphics,Sprite=Entity.extend({img:null,path:"",x:0,y:0,width:0,height:0,angle:0,scale:null,uv:null,rect:null,useBoundingBox:!0,radius:0,center:null,alpha:1,constructor:function(t){this.callParent(t),this.img=Graphics.getImage(t),this.path=t,Utils.isEmpty(this.img)?(this.width=0,this.height=0):(this.width=this.img.width,this.height=this.img.height),this.radius=Math.max(this.width,this.height)/2,this.scale={x:1,y:1},this.rect={x:this.x,y:this.y,w:this.width,h:this.height},this.uv={x:this.x,y:this.y,w:this.width,h:this.height},this.center={x:this.x+this.width/2,y:this.y+this.height/2}},draw:function(){this.callParent(),Graphics.drawSpriteCropped(this.img,this.x,this.y,this.width,this.height,this.angle,this.scale.x,this.scale.y,this.alpha,this.uv.x,this.uv.y,this.uv.w,this.uv.h)},drawDebug:function(){this.useBoundingBox?Graphics.drawRect(this.rect.x,this.rect.y,this.rect.w,this.rect.h,1,1,1,1,"stroke"):Graphics.drawCircle(this.x+this.width/2,this.y+this.height/2,this.radius,0,0,1,1,"stroke")},update:function(t){this.callParent(t),this.recalculate()},recalculate:function(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2,this.useBoundingBox&&(this.rect.x=this.x*this.scale.x,this.rect.y=this.y*this.scale.y,this.rect.w=this.width*this.scale.x,this.rect.h=this.height*this.scale.y)},setSource:function(t){this.path=t,this.img=Graphics.getImage(this.path),Utils.isEmpty(this.img)?(this.width=0,this.height=0):(this.width=this.img.width,this.height=this.img.height),this.radius=Math.max(this.width,this.height)/2,this.rect.w=this.width,this.rect.h=this.height,this.uv.w=this.width,this.uv.h=this.height,this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2},setUV:function(t,e,i,s){this.uv={x:t,y:e,w:i,h:s},this.width=i,this.height=s},resetUV:function(){this.uv={x:this.x,y:this.y,w:this.width,h:this.height}},collides:function(t){var e;return this.useBoundingBox&&t.useBoundingBox&&this.rect.x<=t.rect.x+t.rect.w&&t.rect.x<=this.rect.x+this.rect.w&&this.rect.y<=t.rect.y+t.rect.h&&t.rect.y<=this.rect.y+this.rect.h?!0:0!==this.radius&&0!==t.radius&&(e=Utils.distance(this.x+this.width/2,this.y+this.height/2,t.x+t.width/2,t.y+t.height/2),e<=this.radius+t.radius)?!0:!1},isPointInRect:function(t,e){return t>=this.rect.x&&t<=this.rect.x+this.rect.w&&e>=this.rect.y&&e<=this.rect.y+this.rect.h?!0:!1},isPointInCircle:function(t,e){return Utils.distance(this.x+this.width/2,this.y+this.height/2,t,e)<=this.radius?!0:!1}}),Atlas=Sprite.extend({constructor:function(t){this.callParent(t)},getImage:function(t,e,i,s){var n=new Sprite(this.path);return n.x=this.x,n.y=this.y,n.setUV(t,e,i,s),n},drawTile:function(t,e,i,s,n,a,h,r){Utils.isEmpty(this.img)||Graphics.context.drawImage(this.img,n,a,h,r,t,e,i,s)}}),Label=Sprite.extend({str:"",size:16,r:1,g:1,b:1,font:"Times",constructor:function(t){this.callParent("Label_"+t),this.str=t,this.x=0,this.y=0,this.alpha=1},draw:function(){Graphics.drawText(this.str,this.x,this.y,this.r,this.g,this.b,this.alpha,this.size,this.font)}}),Button=Sprite.extend({onClickFunc:null,text:null,enabled:!0,constructor:function(t,e,i,s){this.callParent(t,e,i),this.onClickFunc=s,Input.addInputReceiver(this)},setText:function(t){return this.text=new Text(t),this.text},draw:function(){this.callParent(),null!==this.text&&this.text.draw()},drawDebug:function(){Graphics.drawRect(this.x,this.y,this.width,this.height,1,1,1)},onClickInput:function(t,e){var i=Graphics.getCanvasOffset();this.isPointInRect((t-i.left)/Graphics.scale.x,(e-i.top)/Graphics.scale.y)&&this.enabled&&this.onClickFunc(this)}}),ParticleBase=Sprite.extend({radius:10,wander:3.15,theta:Math.random(6.28),drag:.92,vx:0,vy:0,r:1,g:1,b:1,constructor:function(t,e,i,s){this.callParent(t,e,i,"particle"),this.radius=s,this.spawn()},update:function(t){this.callParent(t),this.vx*=this.drag,this.vy*=this.drag,this.theta+=Utils.randRange(-.5,.5)*this.wander,this.vx+=Math.sin(this.theta)*t,this.vy+=Math.cos(this.theta)*t,this.x+=this.vx,this.y+=this.vy,this.radius*=.96,this.inUse=this.radius>1},draw:function(){},spawn:function(){this.callParent(),this.radius=Utils.randRange(10,50),this.wander=Utils.randRange(.01,.05),this.drag=Utils.randRange(.5,.79),this.theta=6.28*Math.random(),this.force=Utils.randRange(.01,.03),this.vx=Math.sin(this.theta)*this.force,this.vy=Math.cos(this.theta)*this.force,this.r=Utils.randRange(0,1),this.g=Utils.randRange(0,1),this.b=Utils.randRange(0,1),this.alpha=Utils.randRange(0,1)},clone:function(){var t=new ParticleBase(this.path,this.x,this.y,this.radius);return t=Utils.copyAttributes(t,this)}}),ParticleCircle=ParticleBase.extend({constructor:function(t,e,i,s){this.callParent(t,e,i,s)},draw:function(){Graphics.drawCircle(this.x,this.y,this.radius,this.r,this.g,this.b,this.a)}}),ParticleSystem=Pool.extend({constructor:function(){this.callParent("ParticleSystem")},spawn:function(t,e,i){var s=[];s=this.callParent(i);for(var n=0;n<s.length;n++)s[n].x=t,s[n].y=e}}),SoundDef=Base.extend({soundSupported:!1,constructor:function(){this.soundSupported=!!document.createElement("audio").canPlayType},hasSound:function(){return this.soundSupported}}),Sound=new SoundDef,Song=Base.extend({path:"",loops:!1,song:null,playing:!1,constructor:function(t,e){this.path=t,this.loops=e,this.song=document.createElement("audio"),this.song.setAttribute("src",this.path),this.loops&&this.song.setAttribute("loop",!0)},play:function(){Audio.hasSound()&&null!==this.song&&(this.playing=!0,this.song.play())},pause:function(){Audio.hasSound()&&null!==this.song&&(this.playing=!1,this.song.pause())},stop:function(){Audio.hasSound()&&null!==this.song&&(this.playing=!1,this.song.pause(),isNaN(this.song.duration)||(this.song.currentTime=0))},setVolume:function(t){Audio.hasSound()&&null!==this.song&&(this.song.volume=t)}});